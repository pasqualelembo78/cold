<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <title>Test Wallet API - Mevacoin</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: 40px auto; background: #f7f7f7; padding: 20px; border-radius: 12px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    h1 { text-align: center; color: #333; }
    button { display: block; margin: 20px auto; padding: 10px 20px; font-size: 16px; cursor: pointer; background-color: #1976d2; color: white; border: none; border-radius: 6px; }
    button:hover { background-color: #125a9c; }
    pre { background: #272822; color: #f8f8f2; padding: 15px; border-radius: 8px; white-space: pre-wrap; word-wrap: break-word; }
    .success { color: #4CAF50; font-weight: bold; }
    .error { color: #F44336; font-weight: bold; }
  </style>
</head>
<body>
  <h1>Test Connessione Mevacoin Wallet API</h1>

  <button id="creaWallet">Crea Nuovo Wallet</button>

  <pre id="output">Clicca sul pulsante per iniziare...</pre>

  <script>
    document.getElementById('creaWallet').addEventListener('click', async () => {
      const output = document.getElementById('output');
      output.textContent = "Creazione wallet in corso...";

      const filename = "testwallet_" + Date.now() + ".wallet";
      const password = "desy2011";

      try {
        const response = await fetch('api.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ filename, password })
        });

        const text = await response.text();
        console.log('Raw response:', text);

        try {
          const data = JSON.parse(text);
          
          if(data.status === "success") {
            output.innerHTML = `<span class="success">✔ Wallet creato con successo!</span>\nNome file: ${data.wallet_file}\n\nRisposta raw:\n${data.wallet_response_raw || '(vuota)'}`;
          } else {
            output.innerHTML = `<span class="error">❌ Errore nella creazione del wallet</span>\nDettagli:\n${JSON.stringify(data, null, 2)}`;
          }

        } catch (e) {
          output.innerHTML = `<span class="error">❌ Risposta non JSON</span>\n${text}`;
        }

        if (!response.ok) {
          console.warn('HTTP status non OK:', response.status);
        }

      } catch(err) {
        output.innerHTML = `<span class="error">❌ Errore JS</span>\n${err.message}`;
      }
    });
  </script>
</body>
</html>